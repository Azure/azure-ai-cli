pool:
  vmImage: ubuntu-latest
trigger:
  branches:
    include:
      - refs/tags/v*
    exclude:
      - '*'
  pr: none
steps:
  - task: Bash@3
    inputs:
      filePath: ./.azure/pipelines/scripts/set-variables.sh
    displayName: 'Set up environment variables'
  - task: DotNetCoreCLI@2
    displayName: Restore packages
    inputs:
      command: restore
      projects: 'src/ai/**/*.csproj'
  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      command: build
      projects: 'src/ai/**/*.csproj'
      arguments: '--configuration Release'
  - task: DotNetCoreCLI@2
    displayName: Pack
    env:
      AI_VERSION: $(AICLIVersion)
    inputs:
      command: pack
      packagesToPack: 'src/ai/ai-cli.csproj'
      versioningScheme: 'byEnvVar'
      versionEnvVar: 'AI_VERSION'
      arguments: '--configuration Release'
  - task: AzureCLI@2
    inputs:
      azureSubscription: 'Carbon Dropper (CSSpeechStorage Drop)'
      scriptType: 'bash'
      arguments: '$(Build.StagingDirectory)/$(AICLINuPkgFileName) private/ai/$(AICLINuPkgFileName)'
      scriptPath: './.azure/pipelines/scripts/upload-file.sh'